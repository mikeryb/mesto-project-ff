(()=>{"use strict";var t="https://nomoreparties.co/v1/wff-cohort-39/",e="application/json",n="e4307151-f9f4-457f-86d0-9ae28e4516f5";function o(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}function r(){return fetch("".concat(t,"users/me"),{headers:{authorization:n}}).then((function(t){return o(t)}))}function c(e){return fetch("".concat(t,"cards/likes/").concat(e.id),{method:"DELETE",headers:{authorization:n}}).then((function(t){return o(t)}))}function u(e){return fetch("".concat(t,"cards/likes/").concat(e.id),{method:"PUT",headers:{authorization:n}}).then((function(t){return o(t)}))}var i=document.querySelector("#card-template").content;function a(t,e,n,o,r,c,u,a,l,s,d,f,p,m,_,h,y,v){var S=i.querySelector(".card").cloneNode(!0),q=S.querySelector(".card__image"),g=S.querySelector(".card__like-button");return q.setAttribute("src",e),q.setAttribute("alt",t),S.setAttribute("id",a),S.querySelector(".like_counter").textContent=l,S.querySelector(".card__title").textContent=t,function(t,e,n,o,r,c,u,i,a){var l=n.querySelector(".card__delete-button");t===e?l.addEventListener("click",(function(){return i(n,o,r,c,u,a)})):l.remove()}(s,d,S,a,f,p,m,n,h),g.addEventListener("click",(function(t){!function(t,e,n){var o=t.target.classList,r=t.target.closest(".card"),c=r.querySelector(".like_counter");o.contains("card__like-button_is-active")?e(r).then((function(t){c.textContent=t.likes.length,o.remove("card__like-button_is-active")})).catch((function(t){return console.log(t)})):n(r).then((function(t){c.textContent=t.likes.length,o.add("card__like-button_is-active")})).catch((function(t){return console.log(t)}))}(t,y,v)})),function(t,e,n){t&&t.forEach((function(t){t._id!==e||n.classList.add("card__like-button_is-active")}))}(_,s,g),q.addEventListener("click",(function(t){o(t,r,c,u)})),S}function l(e,r,c,u){(function(e){return fetch("".concat(t,"/cards/").concat(e),{method:"DELETE",headers:{authorization:n}}).then((function(t){return o(t)}))})(e).then((function(){r.remove(),c(u)})).catch((function(t){return console.log(t)}))}function s(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",f)}function d(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",f)}function f(t){"Escape"===t.key&&d(document.querySelector(".popup_is-opened"))}function p(t,e){t.classList.remove(e),document.querySelector(".".concat(t.id,"-error")).textContent=""}function m(t,e){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(t){p(t,e.errorClass)}))}var _,h,y,v,S,q,g,b,k,C=document.querySelector(".places__list"),E=document.querySelector(".profile__edit-button"),L=document.querySelector(".popup_type_edit"),x=document.querySelector(".profile__add-button"),A=document.querySelector(".popup_type_new-card"),w=document.querySelector(".popup_type_image"),T=document.querySelector(".profile__title"),z=document.querySelector(".profile__description"),D=document.querySelector(".profile__image"),P=document.querySelector('form[name="edit-profile"]'),B=document.querySelector('form[name="new-place"]'),N=document.querySelector(".popup__image"),O=document.querySelector(".popup__caption"),j=B.querySelector('[name="place-name"]'),J=B.elements.link,M=document.querySelectorAll(".popup"),H=document.querySelector(".popup_type_delete"),V={inputSelector:".popup__input",errorClass:"popup__input_error"},U=document.querySelector(".profile__image"),F=document.querySelector(".popup_type_new-ava"),G=F.querySelector(".popup__form");function I(){return r().then((function(t){return t._id}))}function K(t,e,n,o,r,c){n(o),o.querySelector(".button").addEventListener("click",(function(n){c(e,t,r,o)}))}function Q(t,e,n,o){t.target.classList.contains("card__image")&&(e.src=t.target.src,e.alt=t.target.alt,o.textContent=t.target.alt,s(n))}_=T,h=D,y=z,r().then((function(t){_.textContent=t.name,h.style="background-image: url(".concat(t.avatar,")"),y.textContent=t.about})).catch((function(t){return console.log(t)})),I().then((function(e){!function(e,r,i,a,l,s,d,f,p,m,_,h){fetch("".concat(t,"/cards"),{headers:{authorization:n}}).then((function(t){return o(t)})).then((function(t){t.forEach((function(t){e.append(_(t.name,t.link,r,i,a,l,s,t._id,t.likes.length,d,t.owner._id,f,p,m,t.likes,h,c,u))}))})).catch((function(t){return console.log(t)}))}(C,K,Q,N,w,O,e,s,H,d,a,l)})),S=(v={formSelector:".popup__form",inputErrorClass:"popup__input_error",submitButtonSelector:".popup__button",inputSelector:".popup__input",inactiveButtonClass:"popup__button_disabled"}).formSelector,q=v.inputSelector,g=v.submitButtonSelector,b=v.inactiveButtonClass,k=v.inputErrorClass,Array.from(document.querySelectorAll(S)).forEach((function(t){t.addEventListener("input",(function(e){var n,o,r,c,u;c=e.target,u=k,c.validity.patternMismatch?c.setCustomValidity(c.dataset.errorMessage):c.setCustomValidity(""),c.validity.valid?p(c,u):function(t,e,n){t.classList.add(e),document.querySelector(".".concat(t.id,"-error")).textContent=n}(c,u,c.validationMessage),n=Array.from(t.querySelectorAll(q)),o=t.querySelector(g),r=b,function(t){return t.some((function(t){return!t.validity.valid}))}(n)?(o.disabled=!0,o.classList.add(r)):(o.disabled=!1,o.classList.remove(r))}))})),U.addEventListener("click",(function(){G.reset(),s(F),G.addEventListener("submit",(function(r){r.preventDefault(),function(r,c,u,i){var a,l=r.querySelector(".button");l.textContent="Сохранение...",(a=r.querySelector(".popup__input").value,fetch("".concat(t,"users/me/avatar"),{method:"PATCH",headers:{authorization:n,"Content-Type":e},body:JSON.stringify({avatar:a})}).then((function(t){return o(t)}))).then((function(t){u.style="background-image: url(".concat(t.avatar,")"),c.reset(),i(r)})).catch((function(t){console.log(t)})).finally((function(){l.textContent="Сохранить"}))}(F,G,D,d)})),m(G,V)})),M.forEach((function(t){t.querySelector(".popup__close").addEventListener("click",(function(){d(t)})),t.addEventListener("mousedown",(function(e){e.target.classList.contains("popup")&&d(t)}))})),E.addEventListener("click",(function(){s(L),function(t,e,n){t.elements.name.value=e.textContent,t.elements.description.value=n.textContent,m(t,V)}(P,T,z)})),x.addEventListener("click",(function(){s(A)})),P.addEventListener("submit",(function(r){!function(r,c,u,i,a){r.preventDefault();var l=c.elements.name,s=c.elements.description;!function(r,c,u,i,a){var l=u.querySelector(".button");l.textContent="Сохранение...",function(r,c){return fetch("".concat(t,"users/me"),{method:"PATCH",headers:{authorization:n,"Content-Type":e},body:JSON.stringify({name:r,about:c})}).then((function(t){return o(t)}))}(r,c).then((function(t){i.textContent=t.name,a.textContent=t.about,l.textContent="Сохранить",d(u)})).catch((function(t){return console.log(t)}))}(l.value,s.value,a,u,i)}(r,P,T,z,L)})),B.addEventListener("submit",(function(r){!function(r,i,f,p,_,h){r.preventDefault(),function(r,i,a,l,s,d,f,p,_,h,y,v,S,q){var g=q.querySelector(".button");g.textContent="Сохранение...",I().then((function(b){(function(r,c){return fetch("".concat(t,"/cards"),{method:"POST",headers:{authorization:n,"Content-Type":e},body:JSON.stringify({name:r,link:c})}).then((function(t){return o(t)}))})(r,i).then((function(t){y.prepend(v(t.name,t.link,a,l,s,d,f,t._id,t.likes.length,b,t.owner._id,p,_,h,t.likes,S,c,u))})).catch((function(t){console.log(t)})).finally((function(){g.textContent="Сохранить",B.reset(),m(B,V),h(q)}))}))}(j.value,J.value,K,Q,N,w,O,s,H,d,p,a,l,h),i.reset()}(r,B,0,C,0,A)}))})();