(()=>{"use strict";var e=document.querySelector("#card-template").content;function t(t,n,o,r,c,i,u,a,s,l,d,f,p,m,_,h,v,y){var S=e.querySelector(".card").cloneNode(!0),q=S.querySelector(".card__image"),C=S.querySelector(".card__like-button");return q.setAttribute("src",n),q.setAttribute("alt",t),S.setAttribute("id",s),S.querySelector(".like_counter").textContent=l,S.querySelector(".card__title").textContent=t,function(e,t,n,o,r,c,i,u,a,s){var l=n.querySelector(".card__delete-button");e===t?l.addEventListener("click",(function(){return a(n,o,r,c,i,u,s)})):l.remove()}(d,f,S,s,p,m,_,h,o,y),C.addEventListener("click",(function(e){r(e)})),function(e,t,n){e&&e.forEach((function(e){e._id!==t||n.classList.add("card__like-button_is-active")}))}(v,d,C),q.addEventListener("click",(function(e){c(e,i,u,a)})),S}function n(e,t,n,o,r,c,i){o(r),r.querySelector(".button").addEventListener("click",(function(o){i(n,t,e,c,r)}))}function o(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}function r(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)}function c(e){"Escape"===e.key&&r(document.querySelector(".popup_is-opened"))}function i(e,t){e.classList.remove(t),document.querySelector(".".concat(e.id,"-error")).textContent=""}function u(e,t){Array.from(e.querySelectorAll(t.inputSelector)).forEach((function(e){i(e,t.errorClass)}))}function a(e,t,n,o,r){fetch("".concat(e).concat(t),{method:"DELETE",headers:{authorization:"e4307151-f9f4-457f-86d0-9ae28e4516f5"}}).then((function(){n.remove(),o(r)})).catch((function(e){return console.log(e)}))}function s(e){var t=e.target.classList,n=e.target.closest(".card"),o=n.querySelector(".like_counter");t.contains("card__like-button_is-active")?fetch("https://nomoreparties.co/v1/wff-cohort-39/cards/likes/".concat(n.id),{method:"DELETE",headers:{authorization:"e4307151-f9f4-457f-86d0-9ae28e4516f5"}}).then((function(e){return e.json()})).then((function(e){o.textContent=e.likes.length,t.remove("card__like-button_is-active")})).catch((function(e){return console.log(e)})):fetch("https://nomoreparties.co/v1/wff-cohort-39/cards/likes/".concat(n.id),{method:"PUT",headers:{authorization:"e4307151-f9f4-457f-86d0-9ae28e4516f5"}}).then((function(e){return e.json()})).then((function(e){o.textContent=e.likes.length,t.add("card__like-button_is-active")})).catch((function(e){return console.log(e)}))}var l,d,f,p,m,_,h,v,y,S=document.querySelector(".places__list"),q=document.querySelector(".profile__edit-button"),C=document.querySelector(".popup_type_edit"),b=document.querySelector(".profile__add-button"),g=document.querySelector(".popup_type_new-card"),k=document.querySelector(".popup_type_image"),E=document.querySelector(".profile__title"),L=document.querySelector(".profile__description"),x=document.querySelector(".profile__image"),w=document.querySelector('form[name="edit-profile"]'),A=document.querySelector('form[name="new-place"]'),j=document.querySelector(".popup__image"),T=document.querySelector(".popup__caption"),z=A.querySelector('[name="place-name"]'),D=A.elements.link,B=document.querySelectorAll(".popup"),N=document.querySelector(".popup_type_delete"),O={inputSelector:".popup__input",errorClass:"popup__input_error"},P="0f8010b070875d80ca6e74f6",J="https://nomoreparties.co/v1/wff-cohort-39/cards/",M=document.querySelector(".profile__image"),H=document.querySelector(".popup_type_new-ava"),V=H.querySelector(".popup__form");function U(e,t,n,r){e.target.classList.contains("card__image")&&(t.src=e.target.src,t.alt=e.target.alt,r.textContent=e.target.alt,o(n))}!function(e,t,n,o,r,c,i,u,a,s,l,d,f,p,m){fetch("https://nomoreparties.co/v1/wff-cohort-39/cards",{headers:{authorization:"e4307151-f9f4-457f-86d0-9ae28e4516f5"}}).then((function(e){return e.json()})).then((function(e){e.forEach((function(e){t.append(p(e.name,e.link,n,o,r,c,i,u,e._id,e.likes.length,a,e.owner._id,s,l,d,f,e.likes,m))}))})).catch((function(e){return console.log(e)}))}(0,S,n,s,U,j,k,T,P,J,o,N,r,t,a),l=E,d=x,f=L,fetch("https://nomoreparties.co/v1/wff-cohort-39/users/me",{headers:{authorization:"e4307151-f9f4-457f-86d0-9ae28e4516f5"}}).then((function(e){return e.json()})).then((function(e){l.textContent=e.name,d.style="background-image: url(".concat(e.avatar,")"),f.textContent=e.about})),m=(p={formSelector:".popup__form",inputErrorClass:"popup__input_error",submitButtonSelector:".popup__button",inputSelector:".popup__input",inactiveButtonClass:"popup__button_disabled"}).formSelector,_=p.inputSelector,h=p.submitButtonSelector,v=p.inactiveButtonClass,y=p.inputErrorClass,Array.from(document.querySelectorAll(m)).forEach((function(e){e.addEventListener("input",(function(t){var n,o,r,c,u;c=t.target,u=y,c.validity.patternMismatch?c.setCustomValidity(c.dataset.errorMessage):c.setCustomValidity(""),c.validity.valid?i(c,u):function(e,t,n){e.classList.add(t),document.querySelector(".".concat(e.id,"-error")).textContent=n}(c,u,c.validationMessage),n=Array.from(e.querySelectorAll(_)),o=e.querySelector(h),r=v,function(e){return e.some((function(e){return!e.validity.valid}))}(n)?(o.disabled=!0,o.classList.add(r)):(o.disabled=!1,o.classList.remove(r))}))})),M.addEventListener("click",(function(){V.reset(),o(H),V.addEventListener("submit",(function(e){e.preventDefault(),function(e,t,n,o){var r=e.querySelector(".button");r.textContent="Сохранение...",fetch("https://nomoreparties.co/v1/wff-cohort-39/users/me/avatar",{method:"PATCH",headers:{authorization:"e4307151-f9f4-457f-86d0-9ae28e4516f5","Content-Type":"application/json"},body:JSON.stringify({avatar:e.querySelector(".popup__input").value})}).then((function(e){return e.json()})).then((function(c){n.style="background-image: url(".concat(c.avatar,")"),r.textContent="Сохранить",t.reset(),o(e)})).catch((function(e){console.log(e),r.textContent="Сохранить"}))}(H,V,x,r)})),u(V,O)})),B.forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){r(e)})),e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup")&&r(e)}))})),q.addEventListener("click",(function(){o(C),function(e,t,n){e.elements.name.value=t.textContent,e.elements.description.value=n.textContent,u(e,O)}(w,E,L)})),b.addEventListener("click",(function(){A.reset(),u(A,O),o(g)})),w.addEventListener("submit",(function(e){!function(e,t,n,o,c,i){e.preventDefault();var u=t.elements.name,a=t.elements.description;!function(e,t,n,o,r,c){var i=o.querySelector(".button");i.textContent="Сохранение...",fetch(e,{method:"PATCH",headers:{authorization:"e4307151-f9f4-457f-86d0-9ae28e4516f5","Content-Type":"application/json"},body:JSON.stringify({name:t,about:n})}).then((function(e){return e.json()})).then((function(e){r.textContent=e.name,c.textContent=e.about,i.textContent="Сохранить"})).catch((function(e){i.textContent="Сохранить",console.log(e)}))}(i,u.value,a.value,c,n,o),r(c)}(e,w,E,L,C,"https://nomoreparties.co/v1/wff-cohort-39/users/me")})),A.addEventListener("submit",(function(e){!function(e,c,i,u,l,d,f){e.preventDefault(),function(e,t,n,o,r,c,i,u,a,s,l,d,f,p,m,_,h,v){var y=v.querySelector(".button");y.textContent="Сохранение...",fetch("https://nomoreparties.co/v1/wff-cohort-39/cards",{method:"POST",headers:{authorization:"e4307151-f9f4-457f-86d0-9ae28e4516f5","Content-Type":"application/json"},body:JSON.stringify({name:t,link:n})}).then((function(e){return e.json()})).then((function(e){m.prepend(_(e.name,e.link,o,r,c,i,u,a,e._id,e.likes.length,s,e.owner._id,l,d,f,p,e.likes,h)),y.textContent="Сохранить"})).catch((function(e){console.log(e),y.textContent="Сохранить"}))}(0,z.value,D.value,n,s,U,j,k,T,P,J,o,N,r,u,t,a,f),d(f),c.reset()}(e,A,0,S,0,r,g)}))})();