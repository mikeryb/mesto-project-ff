(()=>{"use strict";var t=document.querySelector("#card-template").content;function e(e,n,o,r,c,u,i,a,l,s,d,p,f,m,_,h,y,v){var S=t.querySelector(".card").cloneNode(!0),q=S.querySelector(".card__image"),b=S.querySelector(".card__like-button");return q.setAttribute("src",n),q.setAttribute("alt",e),S.setAttribute("id",l),S.querySelector(".like_counter").textContent=s,S.querySelector(".card__title").textContent=e,function(t,e,n,o,r,c,u,i,a,l){var s=n.querySelector(".card__delete-button");t===e?s.addEventListener("click",(function(){return a(n,o,r,c,u,i,l)})):s.remove()}(d,p,S,l,f,m,_,h,o,v),b.addEventListener("click",(function(t){r(t)})),function(t,e,n){t&&t.forEach((function(t){t._id!==e||n.classList.add("card__like-button_is-active")}))}(y,d,b),q.addEventListener("click",(function(t){c(t,u,i,a)})),S}function n(t,e,n,o,r,c,u){o(r),r.querySelector(".button").addEventListener("click",(function(n){u(e,t,c,r)}))}function o(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",c)}function r(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)}function c(t){"Escape"===t.key&&r(document.querySelector(".popup_is-opened"))}function u(t,e){t.classList.remove(e),document.querySelector(".".concat(t.id,"-error")).textContent=""}function i(t,e){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(t){u(t,e.errorClass)}))}var a="https://nomoreparties.co/v1/wff-cohort-39/",l="application/json",s="e4307151-f9f4-457f-86d0-9ae28e4516f5";function d(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}var p,f,m,_,h,y,v,S,q,b=document.querySelector(".places__list"),g=document.querySelector(".profile__edit-button"),C=document.querySelector(".popup_type_edit"),k=document.querySelector(".profile__add-button"),E=document.querySelector(".popup_type_new-card"),L=document.querySelector(".popup_type_image"),x=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),w=document.querySelector(".profile__image"),T=document.querySelector('form[name="edit-profile"]'),z=document.querySelector('form[name="new-place"]'),D=document.querySelector(".popup__image"),P=document.querySelector(".popup__caption"),B=z.querySelector('[name="place-name"]'),N=z.elements.link,O=document.querySelectorAll(".popup"),j=document.querySelector(".popup_type_delete"),J={inputSelector:".popup__input",errorClass:"popup__input_error"},M="0f8010b070875d80ca6e74f6",H="https://nomoreparties.co/v1/wff-cohort-39/cards/",V=document.querySelector(".profile__image"),U=document.querySelector(".popup_type_new-ava"),F=U.querySelector(".popup__form");function G(t){var e=t.target.classList,n=t.target.closest(".card"),o=n.querySelector(".like_counter");e.contains("card__like-button_is-active")?function(t){return fetch("".concat(a,"cards/likes/").concat(t.id),{method:"DELETE",headers:{authorization:s}}).then((function(t){return d(t)}))}(n).then((function(t){o.textContent=t.likes.length,e.remove("card__like-button_is-active")})).catch((function(t){return console.log(t)})):function(t){return fetch("".concat(a,"cards/likes/").concat(t.id),{method:"PUT",headers:{authorization:s}}).then((function(t){return d(t)}))}(n).then((function(t){o.textContent=t.likes.length,e.add("card__like-button_is-active")})).catch((function(t){return console.log(t)}))}function I(t,e,n,o){(function(t){return fetch("".concat(a,"/cards/").concat(t),{method:"DELETE",headers:{authorization:s}}).then((function(t){return d(t)}))})(t).then((function(){e.remove(),n(o)})).catch((function(t){return console.log(t)}))}function K(t,e,n,r){t.target.classList.contains("card__image")&&(e.src=t.target.src,e.alt=t.target.alt,r.textContent=t.target.alt,o(n))}!function(t,e,n,o,r,c,u,i,l,p,f,m,_,h){fetch("".concat(a,"/cards"),{headers:{authorization:s}}).then((function(t){return d(t)})).then((function(a){a.forEach((function(a){t.append(_(a.name,a.link,e,n,o,r,c,u,a._id,a.likes.length,i,a.owner._id,l,p,f,m,a.likes,h))}))})).catch((function(t){return console.log(t)}))}(b,n,G,K,D,L,P,M,H,o,j,r,e,I),p=x,f=w,m=A,fetch("".concat(a,"users/me"),{headers:{authorization:s}}).then((function(t){return d(t)})).then((function(t){p.textContent=t.name,f.style="background-image: url(".concat(t.avatar,")"),m.textContent=t.about})),h=(_={formSelector:".popup__form",inputErrorClass:"popup__input_error",submitButtonSelector:".popup__button",inputSelector:".popup__input",inactiveButtonClass:"popup__button_disabled"}).formSelector,y=_.inputSelector,v=_.submitButtonSelector,S=_.inactiveButtonClass,q=_.inputErrorClass,Array.from(document.querySelectorAll(h)).forEach((function(t){t.addEventListener("input",(function(e){var n,o,r,c,i;c=e.target,i=q,c.validity.patternMismatch?c.setCustomValidity(c.dataset.errorMessage):c.setCustomValidity(""),c.validity.valid?u(c,i):function(t,e,n){t.classList.add(e),document.querySelector(".".concat(t.id,"-error")).textContent=n}(c,i,c.validationMessage),n=Array.from(t.querySelectorAll(y)),o=t.querySelector(v),r=S,function(t){return t.some((function(t){return!t.validity.valid}))}(n)?(o.disabled=!0,o.classList.add(r)):(o.disabled=!1,o.classList.remove(r))}))})),V.addEventListener("click",(function(){F.reset(),o(U),F.addEventListener("submit",(function(t){t.preventDefault(),function(t,e,n,o){var r,c=t.querySelector(".button");c.textContent="Сохранение...",(r=t.querySelector(".popup__input").value,fetch("".concat(a,"users/me/avatar"),{method:"PATCH",headers:{authorization:s,"Content-Type":l},body:JSON.stringify({avatar:r})}).then((function(t){return d(t)}))).then((function(r){n.style="background-image: url(".concat(r.avatar,")"),c.textContent="Сохранить",e.reset(),o(t)})).catch((function(t){console.log(t),c.textContent="Сохранить"}))}(U,F,w,r)})),i(F,J)})),O.forEach((function(t){t.querySelector(".popup__close").addEventListener("click",(function(){r(t)})),t.addEventListener("mousedown",(function(e){e.target.classList.contains("popup")&&r(t)}))})),g.addEventListener("click",(function(){o(C),function(t,e,n){t.elements.name.value=e.textContent,t.elements.description.value=n.textContent,i(t,J)}(T,x,A)})),k.addEventListener("click",(function(){z.reset(),i(z,J),o(E)})),T.addEventListener("submit",(function(t){!function(t,e,n,o,c){t.preventDefault();var u=e.elements.name,i=e.elements.description;(function(t,e,n,o,r){var c=n.querySelector(".button");c.textContent="Сохранение...",function(t,e){return fetch("".concat(a,"users/me"),{method:"PATCH",headers:{authorization:s,"Content-Type":l},body:JSON.stringify({name:t,about:e})}).then((function(t){return d(t)}))}(t,e).then((function(t){o.textContent=t.name,r.textContent=t.about,c.textContent="Сохранить"})).catch((function(t){return console.log(t)}))})(u.value,i.value,c,n,o),r(c)}(t,T,x,A,C)})),z.addEventListener("submit",(function(t){!function(t,c,u,i,p,f,m){t.preventDefault(),function(t,e,n,o,r,c,u,i,p,f,m,_,h,y,v,S,q){var b=q.querySelector(".button");b.textContent="Сохранение...",function(t,e){return fetch("".concat(a,"/cards"),{method:"POST",headers:{authorization:s,"Content-Type":l},body:JSON.stringify({name:t,link:e})}).then((function(t){return d(t)}))}(t,e).then((function(t){y.prepend(v(t.name,t.link,n,o,r,c,u,i,t._id,t.likes.length,p,t.owner._id,f,m,_,h,t.likes,S)),b.textContent="Сохранить"})).catch((function(t){console.log(t),b.textContent="Сохранить"}))}(B.value,N.value,n,G,K,D,L,P,M,H,o,j,r,i,e,I,m),f(m),c.reset()}(t,z,0,b,0,r,E)}))})();